<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理功能对决 - MBTI卡牌游戏</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="src/styles/main.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f7fafc;
        }
        
        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            flex-direction: column;
            padding: 20px;
        }
        
        .loading h1 {
            color: #4a5568;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #805ad5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-message {
            margin-bottom: 40px;
            text-align: center;
            color: #4a5568;
        }
        
        .functions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 900px;
            width: 100%;
            margin-bottom: 30px;
        }
        
        @media (min-width: 768px) {
            .functions-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .function-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
        }
        
        .function-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        .function-name {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #2d3748;
        }
        
        .function-description {
            font-size: 0.9rem;
            color: #4a5568;
        }
        
        .judging .function-name {
            color: #3182ce; /* Blue for judging functions */
        }
        
        .perceiving .function-name {
            color: #dd6b20; /* Orange for perceiving functions */
        }
        
        .extraverted {
            border-left: 4px solid #805ad5; /* Purple for extraverted */
        }
        
        .introverted {
            border-left: 4px solid #38a169; /* Green for introverted */
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <h1>心理功能对决</h1>
            <div class="spinner"></div>
            <p class="loading-message">正在加载游戏资源...</p>
            
            <div class="functions-grid">
                <!-- Judging Functions: Thinking and Feeling -->
                <div class="function-card judging extraverted">
                    <div class="function-name">外向思维 (Te)</div>
                    <div class="function-description">客观分析，组织系统，高效执行</div>
                </div>
                
                <div class="function-card judging introverted">
                    <div class="function-name">内向思维 (Ti)</div>
                    <div class="function-description">精确分类，理解原理，逻辑推理</div>
                </div>
                
                <div class="function-card judging extraverted">
                    <div class="function-name">外向情感 (Fe)</div>
                    <div class="function-description">团队和谐，情感共鸣，社会认同</div>
                </div>
                
                <div class="function-card judging introverted">
                    <div class="function-name">内向情感 (Fi)</div>
                    <div class="function-description">内在价值，个人真实，道德坚持</div>
                </div>
                
                <!-- Perceiving Functions: Sensing and Intuition -->
                <div class="function-card perceiving extraverted">
                    <div class="function-name">外向感觉 (Se)</div>
                    <div class="function-description">直接体验，实时反应，享受当下</div>
                </div>
                
                <div class="function-card perceiving introverted">
                    <div class="function-name">内向感觉 (Si)</div>
                    <div class="function-description">细节储存，经验比对，传统尊重</div>
                </div>
                
                <div class="function-card perceiving extraverted">
                    <div class="function-name">外向直觉 (Ne)</div>
                    <div class="function-description">联想拓展，可能探索，创新思考</div>
                </div>
                
                <div class="function-card perceiving introverted">
                    <div class="function-name">内向直觉 (Ni)</div>
                    <div class="function-description">深度洞察，趋势预见，远景规划</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- React Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Debugging Script -->
    <script>
        // 全局错误处理函数
        window.addEventListener('error', function(event) {
            console.error('全局错误:', event.message);
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '10px';
            errorDiv.style.left = '10px';
            errorDiv.style.backgroundColor = 'rgba(255,0,0,0.8)';
            errorDiv.style.color = 'white';
            errorDiv.style.padding = '10px';
            errorDiv.style.borderRadius = '5px';
            errorDiv.style.zIndex = '9999';
            errorDiv.textContent = '错误: ' + event.message;
            document.body.appendChild(errorDiv);
        });
        
        // 监控组件状态变化
        window.debugState = {
            appState: null,
            gameBoard: null
        };
        
        // 保存原始console.error
        const originalConsoleError = console.error;
        console.error = function() {
            // 创建错误提示
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '60px';
            errorDiv.style.left = '10px';
            errorDiv.style.backgroundColor = 'rgba(255,0,0,0.8)';
            errorDiv.style.color = 'white';
            errorDiv.style.padding = '10px';
            errorDiv.style.borderRadius = '5px';
            errorDiv.style.zIndex = '9999';
            errorDiv.textContent = '控制台错误: ' + Array.from(arguments).join(' ');
            document.body.appendChild(errorDiv);
            
            // 调用原始错误
            originalConsoleError.apply(console, arguments);
        };
    </script>
    
    <!-- Game Resources - Load these first -->
    <script type="text/babel" src="src/assets/cardsData.js"></script>
    <script type="text/babel" src="src/assets/gameLogic.js"></script>
    
    <!-- Game Components - Load in dependency order -->
    <script type="text/babel" src="src/components/Card.js"></script>
    <script type="text/babel" src="src/components/GameLog.js"></script>
    <script type="text/babel" src="src/components/CardSelection.js"></script>
    <script type="text/babel" src="src/components/RulesModal.js"></script>
    <script type="text/babel" src="src/components/StartScreen.js"></script>
    <script type="text/babel" src="src/components/GameOverScreen.js"></script>
    <script type="text/babel" src="src/components/GameBoard.js"></script>
    <script type="text/babel" src="src/components/App.js"></script>
    
    <!-- Main Entry Point - Load this last -->
    <script type="text/babel" src="src/index.js"></script>
    
    <!-- Render the app after all scripts are loaded -->
    <script>
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (window.renderApp) {
                    window.renderApp();
                }
            }, 500);
            
            // 添加URL参数检查以启用调试模式
            function getUrlParam(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }
            
            // 如果URL中包含debug=true参数，启用调试功能
            if (getUrlParam('debug') === 'true') {
                console.log('调试模式已启用');
                
                // 创建调试工具栏
                const debugBar = document.createElement('div');
                debugBar.style.position = 'fixed';
                debugBar.style.bottom = '0';
                debugBar.style.left = '0';
                debugBar.style.right = '0';
                debugBar.style.backgroundColor = '#2d3748';
                debugBar.style.color = 'white';
                debugBar.style.padding = '10px';
                debugBar.style.fontSize = '14px';
                debugBar.style.zIndex = '9999';
                debugBar.style.display = 'flex';
                debugBar.style.justifyContent = 'space-between';
                debugBar.style.alignItems = 'center';
                
                debugBar.innerHTML = `
                    <div>
                        <strong>调试模式</strong> |
                        <span id="debug-state">正在加载...</span>
                    </div>
                    <div>
                        <button id="debug-btn-test" style="margin-right:10px;background:#805ad5;border:none;color:white;padding:5px 10px;border-radius:4px;">测试组件</button>
                        <a href="debug.html" target="_blank" style="margin-right:10px;background:#38a169;border:none;color:white;padding:5px 10px;border-radius:4px;text-decoration:none;">调试工具</a>
                        <a href="TROUBLESHOOTING.md" target="_blank" style="background:#4299e1;border:none;color:white;padding:5px 10px;border-radius:4px;text-decoration:none;">故障排除</a>
                    </div>
                `;
                
                document.body.appendChild(debugBar);
                
                // 更新状态显示
                window.updateDebugState = function(state) {
                    const stateEl = document.getElementById('debug-state');
                    if (stateEl) {
                        stateEl.innerText = `游戏状态: ${state || '未知'}`;
                    }
                };
                
                // 测试按钮点击事件
                document.getElementById('debug-btn-test').addEventListener('click', function() {
                    console.log('============ 组件测试 ============');
                    console.log('App:', typeof window.App === 'function');
                    console.log('GameBoard:', typeof window.GameBoard === 'function');
                    console.log('StartScreen:', typeof window.StartScreen === 'function');
                    console.log('drawCards:', typeof window.drawCards === 'function');
                    console.log('createPlayerDeck:', typeof window.createPlayerDeck === 'function');
                    
                    const missingComponents = [];
                    
                    ['App', 'GameBoard', 'StartScreen', 'RulesModal', 'GameOverScreen'].forEach(comp => {
                        if (typeof window[comp] !== 'function') {
                            missingComponents.push(comp);
                        }
                    });
                    
                    const missingFunctions = [];
                    
                    ['createPlayerDeck', 'drawCards', 'playCard', 'computerPlay'].forEach(fn => {
                        if (typeof window[fn] !== 'function') {
                            missingFunctions.push(fn);
                        }
                    });
                    
                    if (missingComponents.length > 0) {
                        console.error('缺少组件:', missingComponents.join(', '));
                        alert('检测到缺少组件: ' + missingComponents.join(', ') + '\n请查看控制台获取更多信息。');
                    }
                    
                    if (missingFunctions.length > 0) {
                        console.error('缺少功能函数:', missingFunctions.join(', '));
                        alert('检测到缺少功能函数: ' + missingFunctions.join(', ') + '\n请查看控制台获取更多信息。');
                    }
                    
                    if (missingComponents.length === 0 && missingFunctions.length === 0) {
                        console.log('所有必需的组件和函数都已定义');
                        alert('测试完成: 所有必需的组件和函数都已正确定义。');
                    }
                });
            }
        });
    </script>
    
    <!-- 错误处理 -->
    <script>
        window.addEventListener('error', function(event) {
            console.error('全局错误:', event.error);
            
            // 如果是开始游戏时出现白屏，创建错误提示
            if (document.getElementById('root') && document.getElementById('root').children.length === 0) {
                const errorDiv = document.createElement('div');
                errorDiv.style.padding = '20px';
                errorDiv.style.backgroundColor = '#fff';
                errorDiv.style.border = '2px solid #e53e3e';
                errorDiv.style.borderRadius = '8px';
                errorDiv.style.margin = '20px auto';
                errorDiv.style.maxWidth = '800px';
                
                errorDiv.innerHTML = `
                    <h2 style="color:#e53e3e">游戏加载出错</h2>
                    <p>游戏在加载过程中遇到了问题。这可能是由以下原因导致的：</p>
                    <ul>
                        <li>脚本加载顺序不正确</li>
                        <li>组件或函数未正确注册到全局作用域</li>
                        <li>状态转换逻辑存在问题</li>
                    </ul>
                    <p>请尝试以下解决方案：</p>
                    <ol>
                        <li><strong>刷新页面</strong>: 按Ctrl+F5强制刷新页面，清除缓存</li>
                        <li><strong>检查控制台</strong>: 按F12打开开发者工具，查看具体错误信息</li>
                        <li><strong>使用调试工具</strong>: <a href="debug.html" style="color:#4299e1">打开调试页面</a>检查游戏组件</li>
                        <li><strong>查看故障排除指南</strong>: <a href="TROUBLESHOOTING.md" style="color:#4299e1">阅读故障排除文档</a></li>
                    </ol>
                    <p>或者，您可以<a href="index.html?debug=true" style="color:#4299e1">启用调试模式</a>获取更多信息。</p>
                `;
                
                document.getElementById('root').appendChild(errorDiv);
            }
        });
    </script>
</body>
</html> 